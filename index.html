<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Climate Change Opinions</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!--optional color scales, you can specify your own color scale-->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!-- <script type="text/javascript" src="assets/script/script.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .dashed_grid line {
            stroke: #d3d3d3;
            stroke-dasharray: 5,5;
        }
        .bar:hover {

        }
    </style>
</head>

<body>
    <div class="tooltip"></div>
    <section id="s-0" class="full-color-bg">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    <h1 class="lg-headline">Party affiliation matters.</h1>
                    <p class="lg-subtext">On average, the lowest standing democratic groups rank 30% higher in all categories than all republican groups in the same categories within the same state.</p>
                </div>
                <div class="col-sm-6">
                    <div class="stat-container">
                        <div class="stat-val">30<span>%</span></div>
                        <div class="stat-label">more democrats believe in the <br>effects of climate change</div>
                    </div>
                </div>

            </div>
        </div>
        <!-- onclick="drawChart1()" -->
        <a href="#s-1" id="s0-next-btn" class="btn-next white">next</a>
        <!-- <svg class="chart1"></svg> -->
    </section>
    <section id="s-1">
        <div class="row">
            <div class="col-sm-12">
                <h2>Does your audience Believe Global Warming is Happening?</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <p class="section-p">Let’s say you are have a Republican running for President, and they are about to go on a tour of the nation. They need to know a bit about the states they are visiting, and you need to curate their speeches in each state. Let’s look at who believes global warming is happening. You can see that most of the Republicans in each state are on the same page -- hovering around 50%. There are some outliers though, with New York, New Jersey, Hawaii, California, and Alaska sitting closer to 60%. Interestingly, 4 of these 5 states have a major industry of Healthcare and Social Assistance. Let’s explore this further.</p>
            </div>
            <div class="col-sm-9">
                <h3>Republican belief that global warming is happening</h3>
                <svg class="chart1 scale-down-90"></svg>
            </div>
        </div>
        <!-- onclick="drawChart2()" -->
        <a href="#s-2" id="s1-next-btn" class="btn-next">next</a>
    </section>

    <section id="s-2">
        <div class="row">
            <div class="col-sm-12">
                <h2>If they do, are they worried about it?</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <p class="section-p">The five states we looked at earlier are also worried about global warming. Perhaps when your candidate visits this state, they should discuss how their policies will begin to reverse global warming. The remaining states did not have high percentages of people who believed that global warming is happening, and concordantly do not have high levels of worry. In these states, you might choose to emphasize other stances of the platform, rather than spending time discussing the action your candidate will take regarding policies surrounding global warming.</p>
            </div>
            <div class="col-sm-9">
                <h3>Republican worried about global warming</h3>
                <svg class="chart2 scale-down-90"></svg>
            </div>
        </div>
        <!-- onclick="drawChart3()" -->
        <a href="#s-3" id="s2-next-btn" class="btn-next" >next</a>
    </section>

    <section id="s-3">
        <div class="row">
            <div class="col-sm-12">
                <h2>What are their opinions about regulating CO2? Should you emphasize that in your speech?</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <p class="section-p">New York and New Jersey are two states where the regulation of CO2 matters to them. In these states, it might be a good topic for the candidate to discuss in order to gain support and votes. Other states still have fairly high rates of support, but in New York and New Jersey, addressing this topic could make a more significant difference in the eventual election. </p>
            </div>
            <div class="col-sm-9">
                <h3>Republican support for regulating CO2 as a pollutant</h3>
                <svg class="chart3 scale-down-90"></svg>
            </div>
        </div>
        <!-- onclick="drawChart4()" -->
        <a href="#s-4" id="s3-next-btn" class="btn-next" >next</a>
    </section>

    <section id="s-4">
        <div class="row">
            <div class="col-sm-12">
                <h2>Explore on your own -- What issues is your candidate concerned with? Which states are you visiting?</h2>
            </div>
        </div>
        <div class="row">
            <p></p>
            <div class="btn-group" role="group" id="buttons-2">
                <button id="democrat-btn-2" class="btn active" onclick="showcontrols(this)">Democrats</button>
                <button id="republican-btn-2" class="btn" onclick="showcontrols(this)">Republicans</button>
            </div>
        </div>
        <div id="controls">
            <p class="textlabel">Select variable to view:</p>
            <select id="select_list" onchange="checkactive()">
                <option value="happening">Believe global warming is happening</option>
                <option value="human">Believe global warming is caused by human activity</option>
                <option value="harmUS">Believe global warming will harm US</option>
                <option value="regulate">Support regulating CO2 as a pollutant</option>
                <option value="supportRPS">Support producing 20% electricity from renewable sources</option>
                <option value="fundrenewables">Support funding research for renewable energy sources</option>
                <option value="consensus">Believe most scientists believe global warming is happening</option>
                <option value="worried">Worried about global warming</option>
            </select>
            <div class="tooltip"></div>
        </div>
        <div id="sort_controls">
            <p class="textlabel">Choose how to sort the graph:</p>
            <select id="sort_list" onchange="checkactive()">
                <option value="alphabet">A-Z by State</option>
                <option value="reverse">Z-A by State</option>
                <option value="region">By Region</option>
            </select>
        </div>
        <svg class="chart4 scale-down-80"></svg>
        <svg class="chart5"></svg>
    </section>

    <script>


    var margin = {top: 50 , right: 50, bottom: 100, left: 20}
    var t = d3.transition().duration(2000)
    var tooltip = d3.select(".tooltip")
    window.colorscaleR=d3.scaleOrdinal().range(["#E91D0E","#f699e7","#F6D903", "#BB7F0A"])
    window.colorscaleD=d3.scaleOrdinal().range(["#00BFFF", "#43AA8B","#B784E7", "#5F4BB6"])

    // Calculate averages for Repub/Dem beliefs
    var rep_belief_avgs = {};
    var dem_belief_avgs = {};

    var regions = {};
    var regions_arr = [];


    d3.json("assets/json/climate_data_long.json", function(error,data) {
        //console.log(data)

        window.nested_data = d3.nest().key((d)=>d.Group).entries(data)

        dem = nested_data[0].values
        rep = nested_data[1].values

        drawChart1()
        drawChart2()
        drawChart3()

        // console.log(dem)
        // console.log(dem[0].happening)
        // console.log(rep)

        for(var j = 0; j < 2; ++j) {
	        var avg_happening = 0;
	        var avg_human = 0;
	        var avg_harmUS = 0;
	        var avg_regulate = 0;
	        var avg_supportRPS = 0;
	        var avg_fundrenew = 0;
	        var avg_scientists = 0;
	        var avg_worried = 0;

	        // Calculate Dem Belief Avgs First
	        if(j == 0) {
		        for(var i = 0; i < 50; ++i) {
		        	avg_happening += dem[i].happening;
		        	avg_human += dem[i].human;
		        	avg_harmUS += dem[i].harmUS;
		        	avg_regulate += dem[i].regulate;
		        	avg_supportRPS += dem[i].supportRPS;
		        	avg_fundrenew += dem[i].fundrenewables;
		        	avg_scientists += dem[i].consensus;
		        	avg_worried += dem[i].worried;
		        }
		        dem_belief_avgs["happening"] = avg_happening / 50;
		        dem_belief_avgs["human"] = avg_human / 50;
		        dem_belief_avgs["harmUS"] = avg_harmUS / 50;
		        dem_belief_avgs["regulate"] = avg_regulate / 50;
		        dem_belief_avgs["supportRPS"] = avg_supportRPS / 50;
		        dem_belief_avgs["fundrenewables"] = avg_fundrenew / 50;
		        dem_belief_avgs["consensus"] = avg_scientists / 50;
		        dem_belief_avgs["worried"] = avg_worried / 50;
		    }
		    // Then calculate Rep Belief Avgs
		    else {
		    	for(var i = 0; i < 50; ++i) {
		        	avg_happening += rep[i].happening;
		        	avg_human += rep[i].human;
		        	avg_harmUS += rep[i].harmUS;
		        	avg_regulate += rep[i].regulate;
		        	avg_supportRPS += rep[i].supportRPS;
		        	avg_fundrenew += rep[i].fundrenewables;
		        	avg_scientists += rep[i].consensus;
		        	avg_worried += rep[i].worried;
		        }
		        rep_belief_avgs["happening"] = avg_happening / 50;
		        rep_belief_avgs["human"] = avg_human / 50;
		        rep_belief_avgs["harmUS"] = avg_harmUS / 50;
		        rep_belief_avgs["regulate"] = avg_regulate / 50;
		        rep_belief_avgs["supportRPS"] = avg_supportRPS / 50;
		        rep_belief_avgs["fundrenewables"] = avg_fundrenew / 50;
		        rep_belief_avgs["consensus"] = avg_scientists / 50;
		        rep_belief_avgs["worried"] = avg_worried / 50;
		    }
	    }

        for(var i = 0; i < 50; ++i){
            if(regions[dem[i].Region]) {
                regions[dem[i].Region].push(dem[i].GeoName);
            }
            else {
                regions[dem[i].Region] = [dem[i].GeoName];
            }
        }

        // console.log("regions:")
        // console.log(regions)

        // console.log(dem_belief_avgs)
        // console.log(rep_belief_avgs)


        drawChart4(dem,colorscaleD)
        drawChart5(dem,colorscaleD)
    });

    function showcontrols(element) {
        if (element.id == 'democrat-btn-2') {
            updateChart4(dem,colorscaleD)
            updateChart5(dem,colorscaleD)
        }
        else if(element.id=='republican-btn-2') {
            updateChart4(rep,colorscaleR)
            updateChart5(rep,colorscaleR)
        }
    }

    function checkactive () {
        var rep_btn= $('#republican-btn-2');
        var dem_btn= $('#democrat-btn-2')
        if (rep_btn.hasClass('active')) {
            console.log("rep active")
            updateChart4(rep,colorscaleR)
        }
        else if (dem_btn.hasClass('active')) {
            console.log("dem active")
            updateChart4(dem,colorscaleD)
        }
    }

    function drawChart1() {
        var width = 0.75*window.innerWidth - margin.left - margin.right
        var height = 400
        var chartWidth = 0.8*width

        var x = d3.scaleBand().range([0, chartWidth]).padding(0.1)
        var y = d3.scaleLinear().range([height, 0])
        var sizeScale = d3.scaleLinear().range([5, 10])

        var chart = d3.select(".chart1")
                    .attr("width", width)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")

        var title = chart.append("text")
                    .attr("x", (chartWidth/2))
                    .attr("y", margin.top/2)
                    .attr("text-anchor", "middle")
                    .attr("class","chartTitle")
                    .style("font-size", "24px")
                    .style("font-family","Raleway")
                    .style("font-weight", 700)
                    // .text("Republicans' belief that global warming is happening")

        viz_data=nested_data[1].values

        x.domain(viz_data.map((d) => d.GeoName))
        y.domain([0,100])

        sizeScale.domain([0,d3.max(viz_data, (d) => d.Electoral_Votes)])
        colorscaleR.domain(["Manufacturing", "Health care" , "Retail trade", "Accommodation"])

        var circle = chart.selectAll('circle.dot')
            .data(viz_data);

        //exit
        circle.exit()
        .transition()
        .attr('cx',0)
        .attr('cy',0)
        .remove()

        //update
        circle.attr("r",0).transition()
        .attr('cy', function(d) { return y(d.happening)})
        .attr('r', (d) => sizeScale(d.Electoral_Votes))
        .attr("fill", (d) => colorscaleR(d.Industry));

        //enter
        circle.enter().append("circle")
        .attr("class","dot")
        .attr("transform", "translate(38,0)")
        .attr('cx', (d) =>  x(d.GeoName))
        .attr('cy', function(d) { return y(d.happening) })
        .attr('r',0)
        .transition()
        .attr('r', (d) => sizeScale(d.Electoral_Votes))
        .attr("fill", (d) => colorscaleR(d.Industry));
        //enter & update
        chart.selectAll("circle.dot")
        .on("mouseover", function(d) {
            tooltip.transition()
            .style("opacity", .9)
            tooltip.text("Happening: " + d.happening)
            .style("left", (d3.event.pageX) + "px")
            .style("top", (d3.event.pageY - 28) + "px")
            tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
            tooltip.append("tspan").attr("class","label").text("State: " + d.GeoName)
            tooltip.append("tspan").attr("class","label").text("Industry: " + d.Industry)
        })
        .on("mouseout", (d) => tooltip.transition().style("opacity", 0))

        // x-axis
        chart.append("g")
            .attr("transform", "translate(30," + (height+10) + ")")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.1em")
            .attr("transform", "rotate(-65)");

        // y-axis
        chart.append("g")
            .attr("transform", "translate(30,10)")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisLeft(y))

        var gridlines = d3.axisTop()
                        .tickFormat("")
                        .tickSize(height)
                        .scale(x)
        chart.append("g")
        .attr("class","dashed_grid")
        .attr("transform", "translate(30," + (height+10) + ")")
        .call(gridlines)

        // createLegend
        var legend = d3.select(".chart1")
                .append("g")
                .attr("transform","translate(" + (chartWidth + margin.left + margin.right) + ",0)")
                .selectAll("g")
                .data(colorscaleR.domain())

        legend.enter().append('circle')
            .attr('cx', 10)
            .attr('cy', 12)
            .attr('r', 10)
            .attr("transform", (d,i) => "translate(0," + 30*i + ")")
            .style('fill', colorscaleR)
            .style('stroke', colorscaleR);

        legend.enter().append('text')
            .attr('x', 25)
            .attr('y', 16)
            .attr("class", "legendText")
            .attr("transform",(d,i) => "translate(0," + 30*i + ")")
            .text((d) => d )
    }

    function drawChart2() {
        var width = 0.75*window.innerWidth - margin.left - margin.right
        var height = 400
        var chartWidth = 0.8*width

        var x = d3.scaleBand().range([0, chartWidth]).padding(0.1)
        var y = d3.scaleLinear().range([height, 0])
        var sizeScale = d3.scaleLinear().range([5, 10])

        var chart = d3.select(".chart2")
                    .attr("width", width)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")

        var title = chart.append("text")
                    .attr("x", (chartWidth/2))
                    .attr("y", margin.top/2)
                    .attr("text-anchor", "middle")
                    .attr("class","chartTitle")
                    .style("font-size", "24px")
                    .style("font-family","Raleway")
                    .style("font-weight", 700)
                    // .text("Republicans worried about global warming")

        viz_data=nested_data[1].values

        x.domain(viz_data.map((d) => d.GeoName))
        y.domain([0,100])

        sizeScale.domain([0,d3.max(viz_data, (d) => d.Electoral_Votes)])
        colorscaleR.domain(["Manufacturing", "Health care" , "Retail trade", "Accommodation"])

        var circle = chart.selectAll('circle.dot')
            .data(viz_data);

        //exit
        circle.exit()
                .transition()
                .attr('cx',0)
                .attr('cy',0)
                .remove()

        //update
        circle.attr("r",0).transition()
                .attr('cy', function(d) { return y(d.worried)})
                .attr('r', (d) => sizeScale1(d.Electoral_Votes))
                .attr("fill", (d) => colorscaleR(d.Industry));

        //enter
        circle.enter().append("circle")
                .attr("class","dot")
                .attr("transform", "translate(38,0)")
                .attr('cx', (d) =>  x(d.GeoName))
                .attr('cy', function(d) { return y(d.worried) })
                .attr('r',0)
                .transition()
                .attr('r', (d) => sizeScale(d.Electoral_Votes))
                .attr("fill", (d) => colorscaleR(d.Industry));
        //enter & update
        chart.selectAll("circle.dot")
                .on("mouseover", function(d) {
                    tooltip.transition()
                    .style("opacity", .9)
                    tooltip.text("Happening: " + d.worried)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px")
                    tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
                    tooltip.append("tspan").attr("class","label").text("State: " + d.GeoName)
                    tooltip.append("tspan").attr("class","label").text("Industry: " + d.Industry)
                })
                .on("mouseout", (d) => tooltip.transition().style("opacity", 0))

        // x-axis
        chart.append("g")
            .attr("transform", "translate(30," + (height+10) + ")")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.1em")
            .attr("transform", "rotate(-65)");

        // y-axis
        chart.append("g")
            .attr("transform", "translate(30,10)")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisLeft(y))

        var gridlines = d3.axisTop()
                        .tickFormat("")
                        .tickSize(height)
                        .scale(x)
        chart.append("g")
        .attr("class","dashed_grid")
        .attr("transform", "translate(30," + (height+10) + ")")
        .call(gridlines)

        // createLegend
        var legend = d3.select(".chart2")
                .append("g")
                .attr("transform","translate(" + (chartWidth + margin.left + margin.right) + ",0)")
                .selectAll("g")
                .data(colorscaleR.domain())

        legend.enter().append('circle')
            .attr('cx', 10)
            .attr('cy', 12)
            .attr('r', 10)
            .attr("transform", (d,i) => "translate(0," + 30*i + ")")
            .style('fill', colorscaleR)
            .style('stroke', colorscaleR);

        legend.enter().append('text')
            .attr('x', 25)
            .attr('y', 16)
            .attr("class", "legendText")
            .attr("transform",(d,i) => "translate(0," + 30*i + ")")
            .text((d) => d )
    }

    function drawChart3() {
        var width = 0.75*window.innerWidth - margin.left - margin.right
        var height = 400
        var chartWidth = 0.8*width

        var x = d3.scaleBand().range([0, chartWidth]).padding(0.1)
        var y = d3.scaleLinear().range([height, 0])
        var sizeScale = d3.scaleLinear().range([5, 10])

        var chart = d3.select(".chart3")
                    .attr("width", width)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")

        var title = chart.append("text")
                    .attr("x", (chartWidth/2))
                    .attr("y", margin.top/2)
                    .attr("text-anchor", "middle")
                    .attr("class","chartTitle")
                    .style("font-size", "24px")
                    .style("font-family","Raleway")
                    .style("font-weight", 700)
                    // .text("Republicans support for regulating CO2 as a pollutant")

        viz_data=nested_data[1].values

        x.domain(viz_data.map((d) => d.GeoName))
        y.domain([0,100])

        sizeScale.domain([0,d3.max(viz_data, (d) => d.Electoral_Votes)])
        colorscaleR.domain(["Manufacturing", "Health care" , "Retail trade", "Accommodation"])

        var circle = chart.selectAll('circle.dot')
            .data(viz_data);

        //exit
        circle.exit()
                .transition()
                .attr('cx',0)
                .attr('cy',0)
                .remove()

        //update
        circle.attr("r",0).transition()
                .attr('cy', function(d) { return y(d.regulate)})
                .attr('r', (d) => sizeScale1(d.Electoral_Votes))
                .attr("fill", (d) => colorscaleR(d.Industry));

        //enter
        circle.enter().append("circle")
                .attr("class","dot")
                .attr("transform", "translate(38,0)")
                .attr('cx', (d) =>  x(d.GeoName))
                .attr('cy', function(d) { return y(d.regulate) })
                .attr('r',0)
                .transition()
                .attr('r', (d) => sizeScale(d.Electoral_Votes))
                .attr("fill", (d) => colorscaleR(d.Industry));
        //enter & update
        chart.selectAll("circle.dot")
                .on("mouseover", function(d) {
                    tooltip.transition()
                    .style("opacity", .9)
                    tooltip.text("Happening: " + d.regulate)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px")
                    tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
                    tooltip.append("tspan").attr("class","label").text("State: " + d.GeoName)
                    tooltip.append("tspan").attr("class","label").text("Industry: " + d.Industry)
                })
                .on("mouseout", (d) => tooltip.transition().style("opacity", 0))

        // x-axis
        chart.append("g")
            .attr("transform", "translate(30," + (height+10) + ")")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.1em")
            .attr("transform", "rotate(-65)");

        // y-axis
        chart.append("g")
            .attr("transform", "translate(30,10)")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisLeft(y))

        var gridlines = d3.axisTop()
                        .tickFormat("")
                        .tickSize(height)
                        .scale(x)
        chart.append("g")
        .attr("class","dashed_grid")
        .attr("transform", "translate(30," + (height+10) + ")")
        .call(gridlines)

        // createLegend
        var legend = d3.select(".chart3")
                .append("g")
                .attr("transform","translate(" + (chartWidth + margin.left + margin.right) + ",0)")
                .selectAll("g")
                .data(colorscaleR.domain())

        legend.enter().append('circle')
            .attr('cx', 10)
            .attr('cy', 12)
            .attr('r', 10)
            .attr("transform", (d,i) => "translate(0," + 30*i + ")")
            .style('fill', colorscaleR)
            .style('stroke', colorscaleR);

        legend.enter().append('text')
            .attr('x', 25)
            .attr('y', 16)
            .attr("class", "legendText")
            .attr("transform",(d,i) => "translate(0," + 30*i + ")")
            .text((d) => d )
    }

    function drawChart4(data,color) {
        window.width4 = window.innerWidth - margin.left - margin.right
        window.height4 = 500 - margin.top - margin.bottom
        window.chartWidth4 = 0.8*width4

        window.x4 = d3.scaleBand().range([0, chartWidth4]).padding(0.1)
        window.y4 = d3.scaleLinear().range([height4, 0]).domain([0,100])
        window.sizeScale4 = d3.scaleLinear().range([5, 15])
        color.domain(["Manufacturing", "Health care" , "Retail trade", "Accommodation"])


        window.chart4 = d3.select(".chart4")
                    .attr("width", width4)
                    .attr("height", height4 + margin.top + margin.bottom)

        var title = chart4.append("g")
                    .append("text")
                    .attr("x", (chartWidth4/2))
                    .attr("y", margin.top/2)
                    .attr("text-anchor", "middle")
                    .attr("class","chartTitle")
                    .style("font-size", "24px")
                    .style("font-family","Raleway")
                    .style("font-weight", 700)
                    .text("Chart title");

        window.xaxis4 = chart4.append("g")
                    .attr("transform", "translate(30," + (height4+20) + ")")
                    .style("font-family","Raleway")
                    .style("font-size", "11px");

        window.yaxis4 = chart4.append("g")
            .attr("transform", "translate(30,20)")
            .style("font-family","Raleway")
            .style("font-size", "11px");

        // Adds starting belief variable(happening) average for Dem
        window.dem_avg = chart4.append("g")
                                .attr("id", "dem_avg")
                                .attr("transform", "translate(30, 20)")
                                .append("line")
                                    .style("stroke", "blue")
                                    .style("stroke-width", 3);
        
        // Adds happening average belief line for republicans
        window.rep_avg = chart4.append("g")
                                .attr("id", "rep_avg")
                                .attr("transform", "translate(30, 20)")
                                .append("line")
                                    .style("stroke", "red")
                                    .style("stroke-width", 3);

        // Add grid lines
        window.grid = chart4.append("g")
                    .attr("class","dashed_grid")
                    .attr("transform", "translate(30," + (height4+20) + ")");

        // add LEGEND below
        window.legend4 = d3.select(".chart4")
                .append("g")
                .attr("transform","translate(" + (chartWidth4 + margin.left + margin.right) + ",0)")
                .selectAll("g")
                .data(color.domain());

        legend4.enter().append('circle')
        .attr("class", "legend")
            .attr('cx', 10)
            .attr('cy', 12)
            .attr('r', 10)
            .attr("transform", (d,i) => "translate(0," + 30*i + ")");
            // .style("fill",color)

        legend4.enter().append('text')
            .attr('x', 25)
            .attr('y', 16)
            .attr("class", "legendText")
            .attr("transform",(d,i) => "translate(0," + 30*i + ")")
            .text((d) => d );

        legend4.enter().append('line')
            .attr("x1", 0)
            .attr("x2", 20)
            .attr("y1", 130)
            .attr("y2", 130)
            .style("stroke", "blue")
            .style("stroke-width", 3);

        legend4.enter().append('text')
            .attr('x', 25)
            .attr('y', 133)
            .attr("class", "legendText")
            .text("Dem. Belief Avg");

        legend4.enter().append('line')
            .attr("x1", 0)
            .attr("x2", 20)
            .attr("y1", 150)
            .attr("y2", 150)
            .style("stroke", "red")
            .style("stroke-width", 3);

        legend4.enter().append('text')
            .attr('x', 25)
            .attr('y', 155)
            .attr("class", "legendText")
            .text("Repub. Belief Avg");

        // Update the chart
        updateChart4(data,color)
    }

    function sortxaxis(sort_data, sort_option){
        console.log(sort_option);

        for(var key in regions){
            // console.log(key)
            // console.log(regions[key].length)
            for(var i = 0; i < regions[key].length; ++i){
                regions_arr.push(regions[key][i])
            }
        }

        switch(sort_option) {
            case "alphabet": 
                sort_data.sort(function(x, y){
                   return d3.ascending(x.GeoName, y.GeoName);
                })
                // console.log("Alphabet Alphabet");
                // console.log(sort_data)
                break;
            case "reverse":
                sort_data.sort(function(x, y){
                   return d3.descending(x.GeoName, y.GeoName);
                })
                break;
            case "region":
                sort_data.sort(function(a, b){
                   return regions_arr.indexOf(a.GeoName) - regions_arr.indexOf(b.GeoName)
                })
                // console.log("Region Region")
                // console.log(sort_data)
                break;
        }

        return sort_data;
    }

    function updateChart4(data,color) {
        window.selected = d3.select("#select_list").property("value")
        window.sort_selected = d3.select("#sort_list").property("value")


        data = sortxaxis(data, sort_selected)
        console.log(data)

        x4.domain(data.map((d) => d.GeoName))

        yaxis4.call(d3.axisLeft(y4))

        sizeScale4.domain([0,d3.max(data, (d) => d.Electoral_Votes)])
        color.domain(["Manufacturing", "Health care" , "Retail trade", "Accommodation"])

        var circle = chart4.selectAll('circle.dot')
                        .data(data)

        var dem_line = d3.select("#dem_avg").selectAll("line");
        var rep_line = d3.select("#rep_avg").selectAll("line");     

        // LINE - Update
        dem_line.attr("x1", 0)
                    .attr("x2", chartWidth4)
                    .attr("y1", y4(dem_belief_avgs[selected]))
                    .attr("y2", y4(dem_belief_avgs[selected]));

        rep_line.attr("x1", 0)
                    .attr("x2", chartWidth4)
                    .attr("y1", y4(rep_belief_avgs[selected]))
                    .attr("y2", y4(rep_belief_avgs[selected]));

        //exit
        circle.exit()
            .transition()
            .attr('cx',0)
            .attr('cy',0)
            .remove()

        //update
        circle.attr("r",0).transition()
            .attr('cy', function(d) {
                if (selected == 'regulate') {
                    return y4(d.regulate);
                }
                else if (selected == 'supportRPS') {
                    return y4(d.supportRPS);
                }
                else if (selected == 'fundrenewables') {
                    return y4(d.fundrenewables);
                }
                else if (selected == 'happening') {
                    return y4(d.happening)
                }
                else if (selected == 'human') {
                    return y4(d.human)
                }
                else if (selected == 'consensus') {
                    return y4(d.consensus)
                }
                else if (selected == 'worried') {
                    return y4(d.worried)
                }
                else if (selected == 'harmUS') {
                    return y4(d.harmUS)
                }
            })
            .attr('r', (d) => sizeScale4(d.Electoral_Votes))
            .attr("fill", (d) => color(d.Industry));

        //enter
        circle.enter().append("circle")
            .attr("class","dot")
            .attr("transform", "translate(40,20)")
            .attr('cx', (d) =>  x4(d.GeoName))
            .attr('cy', function(d) {
                if (selected == 'regulate') {
                    return y4(d.regulate)
                }
                else if (selected == 'supportRPS') {
                    return y4(d.supportRPS)
                }
                else if (selected == 'fundrenewables') {
                    return y4(d.fundrenewables);
                }
                else if (selected == 'happening') {
                    return y4(d.happening)
                }
                else if (selected == 'human') {
                    return y4(d.human)
                }
                else if (selected == 'consensus') {
                    return y4(d.consensus)
                }
                else if (selected == 'worried') {
                    return y4(d.worried)
                }
                else if (selected == 'harmUS') {
                    return y4(d.harmUS)
                }
            })
            .attr('r',0)
            .transition()
            .attr('r', (d) => sizeScale4(d.Electoral_Votes))
            .attr("fill", (d) => color(d.Industry));

        //enter & update for Tooltip
        chart4.selectAll("circle.dot")
                    .on("mouseover", function(d) {
                        tooltip.transition()
                        .style("opacity", .9);
                        if (selected == 'regulate') {
                            tooltip.text("Regulate: " + d.regulate)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'supportRPS') {
                            tooltip.text("SupportRPS: " + d.supportRPS)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'fundrenewables') {
                            tooltip.text("Fund Renewable: " + d.fundrenewables)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'happening') {
                            tooltip.text("Happening: " + d.happening)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'human') {
                            tooltip.text("Human: " + d.human)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'consensus') {
                            tooltip.text("Consensus: " + d.consensus)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'worried') {
                            tooltip.text("Worried: " + d.worried)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'harmUS') {
                            tooltip.text("Harm US: " + d.harmUS)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
                        tooltip.append("tspan").attr("class","label").text("State: " + d.GeoName)
                        tooltip.append("tspan").attr("class","label").text("Industry: " + d.Industry)
                    })
                    .on("mouseout", (d) => tooltip.transition().style("opacity", 0));

        // x-axis
        xaxis4.call(d3.axisBottom(x4))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.1em")
            .attr("transform", "rotate(-65)");

        //gridlines
        grid.call(d3.axisTop()
                        .tickFormat("")
                        .tickSize(height4)
                        .scale(x4))

        //legend
        d3.selectAll("circle.legend").style('fill', color);
    }

    function drawChart5(data,color) {
        window.height5 = 4100 - margin.top - margin.bottom
        window.width5 = window.innerWidth - margin.left - margin.right
        window.chartwidth5=width5/4
        window.chartheight5=200

        window.x5 = d3.scaleBand().rangeRound([0, chartwidth5-margin.left-margin.left]).padding([0.1]);
        window.y5 = d3.scaleLinear().range([chartheight5, 0]).domain([0, 100])

        window.chart5 = d3.select(".chart5")
                    .attr("width", width5)
                    .attr("height", height5 + margin.top + margin.bottom)
                    .append("g");

        chart5.append("text")
            .attr("x", width5/2)
            .attr("y", margin.top/2)
            .attr("text-anchor", "middle")
            .style("font-size", "24px")
            .style("font-family","Raleway")
            .style("font-weight", 500)
            .text("State-wise beliefs");

        window.opinions = ["happening", "human", "harmUS", "regulate","supportRPS", "fundrenewables", "consensus", "worried"]
        window.barWidth5 = (chartwidth5-margin.left-margin.left)/opinions.length;

        // state names
        chart5.append("g")
            .attr("class","states")
            .selectAll('rect.bar')
            .data(data, (d) => d.key)
            .enter().append("text")
            .attr("transform", (d, i) => "translate(" + (10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("x", (chartwidth5-margin.left)/2)
            .attr("y", 0)
            .attr("text-anchor", "middle")
            .style("font-size", "14px")
            .style("font-family","Raleway")
            .style("font-weight", 700)
            .text(function(d) {return d.GeoName})

        //y axis
        chart5.append("g")
            .attr("class","yaxis")
            .selectAll('rect.bar').data(data, (d) => d.key)
            .enter().append("g")
            .attr("transform", (d, i) => "translate(" + (9+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "12px")
            .call(d3.axisLeft(y5))

        //x axis
        window.xaxis5 = chart5.append("g")
            .attr("class","xaxis")
            .selectAll('rect.bar').data(data, (d) => d.key)
            .enter().append("g")
            .attr("transform", (d, i) =>
            "translate(" + (9+margin.left+((i%4)*chartwidth5)) + "," + (chartheight5+margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "11px")

        window.allbars = chart5.append("g")
        .attr("class","bars")

        updateChart5(data,color)
    }

    function updateChart5(data,color) {
        d3.selectAll(".barvalue")
        .style("fill","none")

        color.domain(["happening", "human", "harmUS", "regulate","supportRPS", "fundrenewables", "consensus", "worried"])
        x5.domain(opinions)
        xaxis5.call(d3.axisBottom(x5))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.1em")
            .attr("transform", "rotate(-65)");

        var bars = allbars.selectAll('rect.bar')
            .data(data, (d) => d.key)


        //exit
        d3.selectAll(".bar").remove()

        //update

        //enter
        //happening
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((0*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.happening); })
            .attr("height", function(d) { return chartheight5 - y5(d.happening); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)

        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((0*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.happening})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.happening)-5; })

        //human
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((1*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.human); })
            .attr("height", function(d,i) { return chartheight5 - y5(d.human); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((1*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.human})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.human)-5; })

        //harmUS
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((2*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.harmUS); })
            .attr("height", function(d,i) { return chartheight5 - y5(d.harmUS); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((2*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.harmUS})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.harmUS)-5; })

        //regulate
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((3*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.regulate); })
            .attr("height", function(d,i) { return (chartheight5) - y5(d.regulate); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((3*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.regulate})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.regulate)-5; })

        //supportRPS
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((4*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.supportRPS); })
            .attr("height", function(d,i) { return chartheight5 - y5(d.supportRPS); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((4*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.supportRPS})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.supportRPS)-5; })

        //fundrenewables
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((5*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.fundrenewables); })
            .attr("height", function(d,i) { return chartheight5 - y5(d.fundrenewables); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((5*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.fundrenewables})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.fundrenewables)-5; })

        //consensus
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((6*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.consensus); })
            .attr("height", function(d,i) { return chartheight5 - y5(d.consensus); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((6*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.consensus})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.consensus)-5; })

        //worried
        bars.enter().append("rect")
            .attr("transform", (d, i) => "translate(" + ((7*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .attr("class", "bar")
            .attr("y", function(d) { return y5(d.worried); })
            .attr("height", function(d,i) { return chartheight5 - y5(d.worried); })
            .attr("x", (d) => x5(d.key))
            .attr("width", 0)
            .transition(t)
            .attr("width",barWidth5 - 2)
            .attr("fill", color)


        bars.enter().append("text")
            .attr("class","barvalue")
            .attr("transform", (d, i) => "translate(" + ((7*barWidth5)+10+margin.left+((i%4)*chartwidth5)) + "," + (margin.top+((Math.floor(i/4))*(chartheight5+margin.top+50))) + ")")
            .style("font-family","Raleway")
            .style("font-size", "10px")
            .style("font-weight", 600)
            .style("fill", "black")
            .text(function(d) { return d.worried})
            .attr("text-anchor", "middle")
            .attr("x", barWidth5/2)
            .attr("y", function(d) { return y5(d.worried)-5; })



        //enter+update tooltip
        // chart5.selectAll("rect.bar")
        //     .on("mouseover", function(d) {
        //     tooltip.transition().style("opacity", .9);
        //     tooltip.text(d.supportRPS)
        //     .style("left", (d3.event.pageX) + "px")
        //     .style("top", (d3.event.pageY - 28) + "px");
        //     })
        //     .on("mouseout", function (d) {
        //         tooltip.style("opacity", 0);
        //     })
    }

    // UI STUFF

    var rep2_btn = $('#republican-btn-2');
    var dem2_btn = $('#democrat-btn-2');

    rep2_btn.click(function(e) {
        console.log("rep2 clicked");
        dem2_btn.removeClass("active");
        rep2_btn.toggleClass("active");

    });

    dem2_btn.click(function(e) {
        console.log("dem2 clicked");
        rep2_btn.removeClass("active");
        dem2_btn.toggleClass("active");

    });

    $("#s0-next-btn").click(function(e) {
        e.preventDefault();
        $('html, body').animate({
            scrollTop: $("#s-1").offset().top
        }, 500);
    });

    $("#s1-next-btn").click(function(e) {
        e.preventDefault();
        $('html, body').animate({
            scrollTop: $("#s-2").offset().top
        }, 500);
    });

    $("#s2-next-btn").click(function(e) {
        e.preventDefault();
        $('html, body').animate({
            scrollTop: $("#s-3").offset().top
        }, 500);
    });

    $("#s3-next-btn").click(function(e) {
        e.preventDefault();
        $('html, body').animate({
            scrollTop: $("#s-4").offset().top
        }, 500);
    });

</script>

</body>
</html>
